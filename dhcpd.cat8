dhcpd(8)                NetBSD System Manager's Manual                dhcpd(8)

NNAAMMEE
     ddhhccppdd - Dynamic Host Configuration Protocol server

SSYYNNOOPPSSIISS
     ddhhccppdd [--pp --ppoorrtt]

DDEESSCCRRIIPPTTIIOONN
     dhcpd(8) implements the Dynamic Host Configuration Protocol (DHCP) and
     the Internet Bootstrap Protocol (BOOTP).  DHCP allows hosts on a TCP/IP
     network to request and be assigned IP addresses, and also to discover in-
     formation about the network to which they are attached.  BOOTP provides
     similar but much more limited functionality.

OOPPEERRAATTIIOONN
     The DHCP protocol allows a host which is unknown to the network adminis-
     trator to be automatically assigned a new IP address out of a pool of IP
     addresses for its network.   In order for this to work, the network ad-
     ministrator allocates address pools in each subnet and enters them into
     the dhcpd.conf(5) file.

     On startup, dhcpd reads the ddhhccppdd..ccoonnff file and keeps the list of avail-
     able addresses on each subnet in memory.  When a host requests an address
     using the DHCP protocol, dhcpd allocates an address for it.  Each such
     host is assigned a lease, which expires after an amount of time chosen by
     the administrator (by default, one day).  As leases expire, the hosts to
     which they are assigned are expected to renew the leases if they wish to
     continue to use the addresses.   Once a lease has expired, the host to
     which that lease is assigned is no longer permitted to use the IP address
     assigned to it.

     In order to keep track of leases across system reboots and server
     restarts, ddhhccppdd keeps a list of leases it has assigned in the
     dhcpd.leases(5) file.   Before dhcpd grants a lease to a host, it records
     the lease in this file and makes sure that the contents of the file are
     flushed to disk.   This ensures that even in the event of a system crash,
     ddhhccppdd will not forget about a lease that it has assigned.   On startup,
     after reading the ddhhccppdd..ccoonnff file, ddhhccppdd reads the ddhhccppdd..lleeaasseess file to
     refresh its memory about what leases have been assigned.

     New leases are appended to the end of the ddhhccppdd..lleeaasseess file.   In order
     to prevent the file from becoming arbitrarily large, from time to time
     ddhhccppdd creates a new ddhhccppdd..lleeaasseess file from its in-core lease database.
     Once this file has been written to disk, the old file is renamed
     ddhhccppdd..lleeaasseess~~, and the new file is renamed ddhhccppdd..lleeaasseess. If the system
     crashes in the middle of this process, whichever ddhhccppdd..lleeaasseess file re-
     mains will contain all the lease information, so there is no need for a
     special crash recovery process.

     BOOTP support is also provided by this server.   Unlike DHCP, the BOOTP
     protocol requires that the server know the hardware address of the client
     that is to be booted.   The network administrator must determine that ad-
     dress, allocate an IP address for the client, and enter that information
     into the ddhhccppdd..ccoonnff file.

     Whenever changes are made to the ddhhccppdd..ccoonnff file, ddhhccppdd must be restart-
     ed.   To restart ddhhccppdd, send signal 15 to the process ID contained in
     //vvaarr//rruunn//ddhhccppdd..ppiidd, and then re-invoke ddhhccppdd.


CCOONNFFIIGGUURRAATTIIOONN
     The syntax of the dhcpd.conf(8) file is discussed seperately.   This sec-
     tion should be used as an overview of the configuration process, and the
     dhcpd.conf(8) documentation should be consulted for detailed reference
     information.

SSuubbnneettss
     dhcpd(8) needs to know the subnet numbers and netmasks of all subnets for
     which it will be providing service.   In addition, in order to dynamical-
     ly allocate addresses, it must be assigned one or more ranges of address-
     es on each subnet which it can in turn assign to client hosts as they
     boot.   Thus, a very simple configuration providing DHCP support might
     look like this:

          subnet 239.252.197.0 netmask 255.255.255.0
            range 239.252.197.10 239.252.197.250;

     Multiple address ranges may be specified like this:

          subnet 239.252.197.0 netmask 255.255.255.0
            range 239.252.197.10 239.252.197.107
            range 239.252.197.113 239.252.197.250;

     If a subnet will only be provided with BOOTP service and no dynamic ad-
     dress assignment, the range clause can be left out entirely, but the sub-
     net statement must appear.

LLeeaassee LLeennggtthhss
     DHCP leases can be assigned almost any length from zero seconds to infin-
     ity.   What lease length makes sense for any given subnet, or for any
     given installation, will vary depending on the kinds of hosts being
     served.

     For example, in an office environment where systems are added from time
     to time and removed from time to time, but move relatively infrequently,
     it might make sense to allow lease times of a month of more.   In a final
     test environment on a manufacturing floor, it may make more sense to as-
     sign a maximum lease length of 30 minutes - enough time to go through a
     simple test procedure on a network appliance before packaging it up for
     delivery.

     It is possible to specify two lease lengths: the default length that will
     be assigned if a client doesn't ask for any particular lease length, and
     a maximum lease length.   These are specified as clauses to the subnet
     command:

          subnet 239.252.197.0 netmask 255.255.255.0
            range 239.252.197.10 239.252.197.107
            default-lease-time 600
            max-lease-time 7200;

     This particular subnet declaration specifies a default lease time of 600
     seconds (ten minutes), and a maximum lease time of 7200 seconds (two
     hours).   Other common values would be 86400 (one day), 604800 (one week)
     and 2592000 (30 days).

     Each subnet need not have the same lease--in the case of an office envi-
     ronment and a manufacturing environment served by the same DHCP server,
     it might make sense to have widely disparate values for default and maxi-
     mum lease times on each subnet.

BBOOOOTTPP SSuuppppoorrtt
     Each BOOTP client must be explicitly declared in the ddhhccppdd..ccoonnff file.   A
     very basic client declaration will specify the client network interface's
     hardware address and the IP address to assign to that client.   If the
     client needs to be able to load a boot file from the server, that file's
     name must be specified.   A simple bootp client declaration might look
     like this:

          host haagen hardware ethernet 08:00:2b:4c:59:23
            fixed-address 239.252.197.9
            filename "/tftpboot/haagen.boot";

OOppttiioonnss
     DHCP (and also BOOTP with Vendor Extensions) provide a mechanism whereby
     the server can provide the client with information about how to configure
     its network interface (e.g., subnet mask), and also how the client can
     access various network services (e.g., DNS, IP routers, and so on).

     These options can be specified on a per-subnet basis, and, for BOOTP
     clients, also on a per-client basis.   In the event that a BOOTP client
     declaration specifies options that are also specified in its subnet dec-
     laration, the options specified in the client declaration take prece-
     dence.   An reasonably complete DHCP configuration might look something
     like this:

          subnet 239.252.197.0 netmask 255.255.255.0
            range 239.252.197.10 239.252.197.250
            default-lease-time 600 max-lease-time 7200
            option subnet-mask 255.255.255.0
            option broadcast-address 239.252.197.255
            option routers 239.252.197.1
            option domain-name-servers 239.252.197.2, 239.252.197.3
            option domain-name "isc.org";

     A bootp host on that subnet that needs to be in a different domain and
     use a different name server might be declared as follows:

          host haagen hardware ethernet 08:00:2b:4c:59:23
            fixed-address 239.252.197.9
            filename "/tftpboot/haagen.boot"
            option domain-name-servers 192.5.5.1
            option domain-name "vix.com";

     A complete list of DHCP Options and their syntaxes is provided in
     dhcpd.conf(5).

FFIILLEESS
     //eettcc//ddhhccppdd..ccoonnff, //eettcc//ddhhccppdd..lleeaasseess, //vvaarr//rruunn//ddhhccppdd..ppiidd,
     //eettcc//ddhhccppdd..lleeaasseess~~.

SSEEEE AALLSSOO
     dhcpd.conf(5),  dhcpd.leases(5)

AAUUTTHHOORR
     dhcpd(8) was written by Ted Lemon <<mmeelllloonn@@vviixx..ccoomm>> under a contract with
     Vixie Labs.   Funding for this project was provided by the Internet Soft-
     ware Corporation.  Information about the Internet Software Consortium can
     be found at hhttttpp::////wwwwww..iisscc..oorrgg//iisscc.

                                 March 6, 1996                               3
